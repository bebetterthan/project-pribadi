'use client';

import React, { useEffect, useState } from 'react';
import { Card } from '@/components/ui/Card';

interface VulnerabilityDistributionProps {
  vulnerabilities: {
    critical: number;
    high: number;
    medium: number;
    low: number;
  };
}

const severityConfig = [
  { key: 'critical', label: 'Critical', color: '#EF4444' },
  { key: 'high', label: 'High', color: '#F97316' },
  { key: 'medium', label: 'Medium', color: '#F59E0B' },
  { key: 'low', label: 'Low', color: '#3B82F6' },
] as const;

export const VulnerabilityDistribution: React.FC<VulnerabilityDistributionProps> = ({ vulnerabilities }) => {
  const [animatedValues, setAnimatedValues] = useState({
    critical: 0,
    high: 0,
    medium: 0,
    low: 0,
  });

  const total = Object.values(vulnerabilities).reduce((sum, val) => sum + val, 0);

  useEffect(() => {
    // Animate bars on mount
    const timeouts: NodeJS.Timeout[] = [];
    
    severityConfig.forEach((config, index) => {
      const timeout = setTimeout(() => {
        setAnimatedValues(prev => ({
          ...prev,
          [config.key]: vulnerabilities[config.key]
        }));
      }, index * 100); // Stagger animation
      
      timeouts.push(timeout);
    });

    return () => timeouts.forEach(clearTimeout);
  }, [vulnerabilities]);

  const getPercentage = (value: number) => {
    if (total === 0) return 0;
    return Math.round((value / total) * 100);
  };

  if (total === 0) {
    return (
      <Card className="p-6 bg-[#1A1A1A] border border-[#2A2A2A]">
        <h3 className="text-lg font-semibold text-[#F5F5F5] mb-6">Vulnerability Distribution</h3>
        <div className="text-center py-8">
          <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-green-600/10 mb-4">
            <span className="text-3xl">âœ…</span>
          </div>
          <p className="text-[#10B981] font-medium mb-1">No vulnerabilities detected</p>
          <p className="text-sm text-[#A3A3A3]">Your infrastructure is looking secure</p>
        </div>
      </Card>
    );
  }

  return (
    <Card className="p-6 bg-[#1A1A1A] border border-[#2A2A2A]">
      <h3 className="text-lg font-semibold text-[#F5F5F5] mb-6">Vulnerability Distribution</h3>
      
      <div className="space-y-5">
        {severityConfig.map((config) => {
          const value = vulnerabilities[config.key];
          const animatedValue = animatedValues[config.key];
          const percentage = getPercentage(value);
          const animatedPercentage = getPercentage(animatedValue);

          return (
            <div key={config.key} className="space-y-2">
              {/* Label and Value */}
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div 
                    className="w-2 h-2 rounded-full"
                    style={{ backgroundColor: config.color }}
                  />
                  <span 
                    className="text-sm font-medium capitalize"
                    style={{ color: config.color }}
                  >
                    {config.label}
                  </span>
                </div>
                <div className="flex items-center gap-3">
                  <span className="text-2xl font-bold text-[#F5F5F5]">
                    {value}
                  </span>
                  <span className="text-sm text-[#A3A3A3] w-12 text-right">
                    {percentage}%
                  </span>
                </div>
              </div>

              {/* Progress Bar */}
              <div className="relative h-2 bg-[#2A2A2A] rounded-full overflow-hidden">
                <div
                  className="absolute top-0 left-0 h-full rounded-full transition-all duration-600 ease-out"
                  style={{
                    width: `${animatedPercentage}%`,
                    backgroundColor: config.color,
                  }}
                />
              </div>
            </div>
          );
        })}
      </div>

      {/* Total Summary */}
      <div className="mt-6 pt-6 border-t border-[#2A2A2A]">
        <div className="flex items-center justify-between">
          <span className="text-sm font-medium text-[#A3A3A3]">Total Vulnerabilities</span>
          <span className="text-xl font-bold text-[#F5F5F5]">{total}</span>
        </div>
      </div>
    </Card>
  );
};

